# Usamos Python 3.11 Slim para garantir compatibilidade com scikit-learn 1.6+ e numpy 2.0+
# (Imagens alpine podem ter problemas de compila√ß√£o com numpy/pandas novos)
FROM python:3.11-slim

# Define o diret√≥rio de trabalho dentro do container
WORKDIR /app

# 1. Copia apenas o requirements primeiro para aproveitar o cache do Docker
COPY requirements.txt .

# 2. Instala as depend√™ncias
RUN pip install --no-cache-dir -r requirements.txt

# 3. Copia o script de download e app.py
COPY download-model-if-missing.sh app.py ./
RUN chmod +x download-model-if-missing.sh

# 4. Copia o modelo se existir localmente, sen√£o baixa da release
COPY modelo_atraso_voos_rf_res.pkl* ./ 2>/dev/null || true
RUN if [ ! -f modelo_atraso_voos_rf_res.pkl ]; then \
      echo "üì• Baixando modelo da release..."; \
      apt-get update && apt-get install -y curl && \
      curl -L -o modelo_atraso_voos_rf_res.pkl \
        https://github.com/Mateus-Redivo/FlightOnTime/releases/download/v1.0.0/modelo_atraso_voos_rf_res.pkl || \
        (echo "‚ùå Falha ao baixar modelo" && exit 1); \
    fi

# Exp√µe a porta 5000 (padr√£o definido no seu app.py)
EXPOSE 5000

# Comando para iniciar a aplica√ß√£o
# Nota: Para produ√ß√£o real, recomenda-se usar gunicorn, mas python app.py funciona para este setup
CMD ["python", "app.py"]
